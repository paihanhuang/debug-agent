<!DOCTYPE html>
<html>
<head>
    <title>CKG Visualization - Enhanced with Exclusions</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.6/vis-network.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #1a1a2e; color: #eee; }
        #network { width: 100%; height: 700px; border: 1px solid #444; border-radius: 8px; background: #16213e; }
        h1 { color: #0f4c75; }
        .stats { display: flex; gap: 20px; margin: 10px 0; }
        .stat { background: #0f4c75; padding: 10px 20px; border-radius: 5px; }
        .legend { display: flex; gap: 15px; flex-wrap: wrap; margin: 10px 0; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-color { width: 20px; height: 20px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>ðŸ§  Causal Knowledge Graph (Enhanced)</h1>
    <div class="stats">
        <div class="stat">ðŸ“¦ Entities: 26</div>
        <div class="stat">ðŸ”— Relations: 30</div>
        <div class="stat">ðŸ†• exclude_when patterns</div>
    </div>
    <div class="legend">
        <div class="legend-item"><div class="legend-color" style="background:#e74c3c"></div>RootCause</div>
        <div class="legend-item"><div class="legend-color" style="background:#3498db"></div>Component</div>
        <div class="legend-item"><div class="legend-color" style="background:#9b59b6"></div>AnomalyPattern</div>
        <div class="legend-item"><div class="legend-color" style="background:#2ecc71"></div>Metric</div>
        <div class="legend-item"><div class="legend-color" style="background:#f39c12"></div>Symptom</div>
        <div class="legend-item"><div class="legend-color" style="background:#1abc9c"></div>Hypothesis</div>
    </div>
    <div id="network"></div>
    <script>
        const nodes = new vis.DataSet([
            {id: "rc_policy", label: "èª¿æŽ§ç­–ç•¥ (Control Policy)", color: "#e74c3c", shape: "dot", title: "System control policy drives CM behavior"},
            {id: "rc_cm", label: "CM (CPU Manager)", color: "#e74c3c", shape: "dot", title: "CPU management controls frequency and DDR voting via SW_REQ2"},
            {id: "rc_powerhal", label: "PowerHal", color: "#e74c3c", shape: "dot", title: "Power HAL affects DDR voting via SW_REQ3"},
            {id: "rc_mmdvfs", label: "MMDVFS OPP3", color: "#e74c3c", shape: "dot", title: "Multimedia DVFS at OPP3 - causes VCORE 600mV floor (Case3 only)"},
            {id: "cpu_big", label: "CPU å¤§æ ¸", color: "#3498db", shape: "dot", title: "Large cores (1800-2700MHz)"},
            {id: "cpu_mid", label: "CPU ä¸­æ ¸", color: "#3498db", shape: "dot", title: "Medium cores (1000-2500MHz)"},
            {id: "cpu_small", label: "CPU å°æ ¸", color: "#3498db", shape: "dot", title: "Small cores (1000-2100MHz)"},
            {id: "sw_req2", label: "SW_REQ2", color: "#3498db", shape: "dot", title: "DDR voting signal from CM (CPU Manager). If SW_REQ2 is active, root cause is CM."},
            {id: "sw_req3", label: "SW_REQ3", color: "#3498db", shape: "dot", title: "DDR voting signal from PowerHal. If SW_REQ3 is active, root cause is PowerHal."},
            {id: "ddr_vote", label: "DDR æŠ•ç¥¨æ©Ÿåˆ¶", color: "#3498db", shape: "dot", title: "DDR voting mechanism. Check SW_REQ2 for CM, SW_REQ3 for PowerHal."},
            {id: "ddr5460", label: "DDR5460", color: "#3498db", shape: "dot", title: "DDR at 5460 frequency"},
            {id: "ddr6370", label: "DDR6370", color: "#3498db", shape: "dot", title: "DDR at 6370 frequency"},
            {id: "c1_ddr", label: "Case1: DDR 82.6%", color: "#2ecc71", shape: "dot", title: "First case - high DDR usage"},
            {id: "c1_vcore", label: "Case1: VCORE 725mV @ 82.6...", color: "#f39c12", shape: "dot", title: "Severe - ceiling CPUs"},
            {id: "c2_ddr", label: "Case2: DDR 29.67%", color: "#2ecc71", shape: "dot", title: "Second case - moderate DDR"},
            {id: "c2_vcore", label: "Case2: VCORE 725mV @ 29.3...", color: "#f39c12", shape: "dot", title: "Moderate - SW_REQ2+3"},
            {id: "c3_ddr", label: "Case3: DDR 54.14%", color: "#2ecc71", shape: "dot", title: "Third case - DDR5460 23.37% + DDR6370 30.77%"},
            {id: "c3_vcore_high", label: "Case3: VCORE 725mV @ 52.5...", color: "#f39c12", shape: "dot", title: "High - DDR caused"},
            {id: "c3_vcore_floor", label: "Case3: VCORE 600mV floor", color: "#f39c12", shape: "dot", title: "Should be 575mV - MMDVFS caused"},
            {id: "h_mmdvfs", label: "MMDVFS (OPP4)", color: "#1abc9c", shape: "dot", title: "Ruled out for Case1/2 - stayed at OPP4"},
            {id: "pattern_vcore_ceiling_sw_req2", label: "VCORE 725mV via SW_REQ2 (...", color: "#9b59b6", shape: "dot", title: "VCORE 725mV >10% with SW_REQ2 activity indicates CM (CPU Manager) as root cause. SW_REQ2 = CM only."},
            {id: "pattern_vcore_ceiling_sw_req3", label: "VCORE 725mV via SW_REQ3 (...", color: "#9b59b6", shape: "dot", title: "VCORE 725mV >10% with SW_REQ3 activity indicates PowerHal as root cause. SW_REQ3 = PowerHal only."},
            {id: "pattern_vcore_ceiling_both", label: "VCORE 725mV via SW_REQ2+S...", color: "#9b59b6", shape: "dot", title: "VCORE 725mV >10% with BOTH SW_REQ2 AND SW_REQ3 activity indicates both CM and PowerHal as root cause"},
            {id: "pattern_vcore_floor", label: "VCORE Floor Elevated", color: "#9b59b6", shape: "diamond", title: "VCORE floor above 575mV indicates MMDVFS issue. If floor is 600mV, check MMDVFS OPP3 usage."},
            {id: "pattern_mmdvfs_opp3_high", label: "MMDVFS OPP3 High Usage", color: "#9b59b6", shape: "diamond", title: "MMDVFS OPP3 at >50% usage causes VCORE floor lock at 600mV instead of normal 575mV."},
            {id: "pattern_dual_vcore_issue", label: "Dual VCORE Issue (Floor +...", color: "#9b59b6", shape: "dot", title: "When BOTH VCORE floor (>575mV) AND VCORE 725mV (>10%) are abnormal, there are TWO independent root c"},
        ]);
        const edges = new vis.DataSet([
            {from: "rc_policy", to: "rc_cm", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "rc_cm", to: "cpu_big", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "rc_cm", to: "cpu_mid", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "rc_cm", to: "cpu_small", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "cpu_big", to: "sw_req2", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "sw_req2", to: "ddr_vote", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "rc_powerhal", to: "sw_req3", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "sw_req3", to: "ddr_vote", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "ddr_vote", to: "ddr5460", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "ddr_vote", to: "ddr6370", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "ddr5460", to: "c1_ddr", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "ddr6370", to: "c1_ddr", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "c1_ddr", to: "c1_vcore", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "ddr5460", to: "c2_ddr", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "ddr6370", to: "c2_ddr", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "c2_ddr", to: "c2_vcore", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "ddr5460", to: "c3_ddr", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "ddr6370", to: "c3_ddr", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "c3_ddr", to: "c3_vcore_high", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "rc_mmdvfs", to: "c3_vcore_floor", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "h_mmdvfs", to: "c1_vcore", arrows: "to", color: "#e74c3c", dashes: true, title: "RULES_OUT"},
            {from: "h_mmdvfs", to: "c2_vcore", arrows: "to", color: "#e74c3c", dashes: true, title: "RULES_OUT"},
            {from: "pattern_vcore_ceiling_sw_req2", to: "rc_cm", arrows: "to", color: "#3498db", dashes: false, title: "INDICATES"},
            {from: "pattern_vcore_ceiling_sw_req3", to: "rc_powerhal", arrows: "to", color: "#3498db", dashes: false, title: "INDICATES"},
            {from: "sw_req2", to: "rc_cm", arrows: "to", color: "#3498db", dashes: false, title: "INDICATES"},
            {from: "sw_req3", to: "rc_powerhal", arrows: "to", color: "#3498db", dashes: false, title: "INDICATES"},
            {from: "pattern_vcore_floor", to: "rc_mmdvfs", arrows: "to", color: "#3498db", dashes: false, title: "INDICATES"},
            {from: "pattern_mmdvfs_opp3_high", to: "c3_vcore_floor", arrows: "to", color: "#27ae60", dashes: false, title: "CAUSES"},
            {from: "pattern_dual_vcore_issue", to: "c3_vcore_floor", arrows: "to", color: "#3498db", dashes: false, title: "INDICATES"},
            {from: "pattern_dual_vcore_issue", to: "c3_vcore_high", arrows: "to", color: "#3498db", dashes: false, title: "INDICATES"},
        ]);
        const container = document.getElementById('network');
        const data = { nodes: nodes, edges: edges };
        const options = {
            physics: { stabilization: { iterations: 150 } },
            nodes: { font: { color: '#fff' }, borderWidth: 2 },
            edges: { smooth: { type: 'curvedCW', roundness: 0.2 } }
        };
        new vis.Network(container, data, options);
    </script>
</body>
</html>